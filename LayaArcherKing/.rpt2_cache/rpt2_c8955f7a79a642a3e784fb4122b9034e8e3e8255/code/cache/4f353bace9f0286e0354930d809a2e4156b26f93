{
  "code": "import MonoBehaviour from \"../Utils/MonoBehaviour\";\r\nvar State = {\r\n    Idle: 0,\r\n    Drawing: 1,\r\n    LookAt: 2,\r\n    Shoot: 3,\r\n};\r\nexport default class GameMgr extends MonoBehaviour {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.rightHand = null;\r\n        this.archerAnim = null;\r\n        this.arrow = null;\r\n        this.camera = null;\r\n        this.state = 0;\r\n        this.uiCursor = null;\r\n        this.physicsSimulation = null;\r\n    }\r\n    Awake() {\r\n    }\r\n    init(uiCursor) {\r\n        this.uiCursor = uiCursor;\r\n        this.configGame();\r\n    }\r\n    configGame() {\r\n        var person = this.gameObject.getChildByName(\"Person\");\r\n        this.camera = person.getChildByName(\"Main Camera\");\r\n        this.rightHand = person.getChildByName(\"RightHand\");\r\n        this.archerAnim = this.rightHand.getChildByName(\"pkGgreenTB\").getComponent(Laya.Animator);\r\n        this.arrow = this.rightHand.getChildByName(\"pkJMrubyC\");\r\n        this.physicsSimulation = this.owner.physicsSimulation;\r\n        this.reset();\r\n        Laya.stage.on(Laya.Event.MOUSE_DOWN, this, this.onTouchStart);\r\n        Laya.stage.on(Laya.Event.MOUSE_UP, this, this.onTouchEnd);\r\n        Laya.stage.on(Laya.Event.MOUSE_MOVE, this, this.onTouchMove);\r\n    }\r\n    reset() {\r\n        this.uiCursor.visible = false;\r\n        this.state = State.Idle;\r\n        this.archerAnim.play(\"Idle\");\r\n    }\r\n    onTouchStart() {\r\n        if (this.state !== State.Idle) {\r\n            return;\r\n        }\r\n        this.state = State.Drawing;\r\n        this.archerAnim.play(\"Draw\");\r\n        Laya.Tween.to(this.arrow.transform, { localPositionZ: 0.132 }, 667);\r\n        this.gameObject.timerOnce(1000, this, function () {\r\n            this.state = State.LookAt;\r\n            this.uiCursor.visible = true;\r\n            this.lookTarget();\r\n        });\r\n    }\r\n    lookTarget() {\r\n        var point = new Laya.Vector2(Laya.stage.mouseX, Laya.stage.mouseY);\r\n        var ray = new Laya.Ray(new Laya.Vector3(0, 0, 0), new Laya.Vector3(0, 0, 1));\r\n        this.camera.viewportPointToRay(point, ray);\r\n        var resultHit = new Laya.HitResult();\r\n        if (this.physicsSimulation.rayCast(ray, resultHit)) {\r\n            var pt = resultHit.point;\r\n            this.rightHand.transform.lookAt(pt, new Laya.Vector3(0, 1, 0), false);\r\n            var screenPoint = new Laya.Point(Laya.stage.mouseX, Laya.stage.mouseY);\r\n            var pos = this.uiCursor.parent.fromStagePoint(screenPoint);\r\n            this.uiCursor.pos(pos.x, pos.y);\r\n        }\r\n    }\r\n    onTouchMove() {\r\n        if (this.state !== State.LookAt) {\r\n            return;\r\n        }\r\n        this.lookTarget();\r\n    }\r\n    onTouchEnd() {\r\n        if (this.state !== State.LookAt) {\r\n            return;\r\n        }\r\n        this.state = State.Shoot;\r\n        this.uiCursor.visible = false;\r\n        this.shootArrow();\r\n    }\r\n    shootArrow() {\r\n        this.archerAnim.play(\"Idle\");\r\n    }\r\n    Start() {\r\n    }\r\n    Update() {\r\n    }\r\n}\r\n",
  "references": [
    "D:/company/LayaAir001/LayaArcherKing/src/Scripts/Utils/MonoBehaviour.ts"
  ]
}
